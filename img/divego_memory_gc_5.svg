<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1021px" height="431px" viewBox="-0.5 -0.5 1021 431" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 230 240 Q 230 240 273.63 240" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 278.88 240 L 271.88 243.5 L 273.63 240 L 271.88 236.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 40 165 L 40 164.28 L 50 164.65 L 60 165.58 L 70 165.26 L 80 165.08 L 90 165.67 L 100 165.31 L 110 164.48 L 120 165.46 L 130 165.52 L 140 164.65 L 150 164.88 L 160 164.63 L 170 165.46 L 180 164.33 L 190 165.46 L 200 165.14 L 210 165.72 L 220 164.78 L 230 165 L 230.21 165 L 230.47 175 L 230.01 185 L 230.59 195 L 229.66 205 L 230.55 215 L 230.33 225 L 230.11 235 L 229.66 245 L 229.71 255 L 229.51 265 L 230.68 275 L 230.61 285 L 229.45 295 L 230.6 305 L 230 315 L 230 315.42 L 220 315.66 L 210 314.68 L 200 315.49 L 190 315.71 L 180 314.81 L 170 314.56 L 160 315.13 L 150 315.7 L 140 315.6 L 130 315.36 L 120 314.4 L 110 315 L 100 315.53 L 90 315.46 L 80 315.39 L 70 314.27 L 60 315.38 L 50 315.26 L 40 315 L 39.4 315 L 39.75 305 L 40.15 295 L 40.48 285 L 39.58 275 L 40.51 265 L 40.64 255 L 39.54 245 L 39.77 235 L 40.07 225 L 40.27 215 L 39.91 205 L 39.3 195 L 40.47 185 L 40.39 175 L 40 165 L 40 165 Z Z" fill="#e3c800" stroke="#b09500" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 182px; height: 1px; padding-top: 155px; margin-left: 45px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 160px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1><font face="Comic Sans MS">清理终止阶段</font></h1><p><font face="Comic Sans MS">① <b><font color="#cc0000">暂停程序</font></b>。此时，所有处理器都会进入安全点</font></p><p><font face="Comic Sans MS">② 如果当前垃圾收集循环是强制触发的，那么还需要处理尚未清理的内存管理单元</font></p></div></div></div></foreignObject><text x="45" y="167" fill="#ffffff" font-family="Helvetica" font-size="12px">清理终止阶段① 暂停程序。此时，所有处理器都会进入安全点...</text></switch></g><path d="M 490 240 Q 490 240 563.63 240" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 568.88 240 L 561.88 243.5 L 563.63 240 L 561.88 236.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 280 50 L 280 50.58 L 290 49.53 L 300 49.9 L 310 50.49 L 320 50.66 L 330 50.07 L 340 50.26 L 350 50.37 L 360 49.73 L 370 49.78 L 380 50.05 L 390 50.46 L 400 50.03 L 410 50.42 L 420 50.68 L 430 50.06 L 440 49.82 L 450 50.47 L 460 50.12 L 470 49.49 L 480 50.37 L 490 50 L 489.7 50 L 489.97 60 L 489.91 70 L 490.38 80 L 490.49 90 L 489.36 100 L 489.48 110 L 490.51 120 L 489.56 130 L 489.95 140 L 489.4 150 L 490.53 160 L 489.79 170 L 490.67 180 L 489.9 190 L 489.28 200 L 490.68 210 L 490.18 220 L 489.53 230 L 490.32 240 L 490.08 250 L 490.53 260 L 489.45 270 L 490.1 280 L 489.54 290 L 489.67 300 L 489.49 310 L 490.33 320 L 489.91 330 L 490.64 340 L 489.83 350 L 490.51 360 L 489.75 370 L 490.16 380 L 489.87 390 L 489.5 400 L 490.23 410 L 490.21 420 L 490 430 L 490 430.68 L 480 429.51 L 470 429.45 L 460 429.6 L 450 429.27 L 440 429.76 L 430 430.56 L 420 430.03 L 410 429.77 L 400 429.7 L 390 429.54 L 380 429.41 L 370 430.68 L 360 429.36 L 350 429.74 L 340 429.35 L 330 429.64 L 320 430.65 L 310 430.5 L 300 430.56 L 290 430.09 L 280 430 L 279.5 430 L 279.56 420 L 279.82 410 L 279.28 400 L 279.31 390 L 280.73 380 L 279.97 370 L 280.45 360 L 279.32 350 L 279.71 340 L 280 330 L 279.77 320 L 279.74 310 L 279.78 300 L 279.31 290 L 279.52 280 L 279.27 270 L 279.84 260 L 280.14 250 L 279.5 240 L 279.32 230 L 279.38 220 L 279.86 210 L 280.32 200 L 279.5 190 L 280.2 180 L 280.12 170 L 280.55 160 L 280.71 150 L 279.62 140 L 279.64 130 L 280.23 120 L 280.01 110 L 280.26 100 L 279.48 90 L 279.59 80 L 279.93 70 L 280.07 60 L 280 50 L 280 50 Z Z" fill="#cdeb8b" stroke="#36393d" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 202px; height: 1px; padding-top: 40px; margin-left: 285px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 390px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1><font face="Comic Sans MS">标记阶段</font></h1><p><font face="Comic Sans MS">① 将状态切换至 <b><font color="#006633">_GCmark</font></b>，开启写屏障，用户程序协助（Mutator Assiste）并将根对象入队</font></p><p><font face="Comic Sans MS">② 恢复执行程序。标记进程和用于协助的用户程序会开始并发标记内存中的对象。写屏障会将被覆盖的指针和新指针都标记成灰色，而所有新创建的对象都会被直接标记成黑色</font></p><p><font face="Comic Sans MS">③ 开始扫描根对象（包括所有 Goroutine 的栈、全局对象以及不在堆中的运行时数据结构），扫描 Goroutine 栈期间会暂停当前处理器</font></p><p><font face="Comic Sans MS">④ 依次处理灰色队列中的对象，将对象标记成黑色并将它们指向的对象标记成灰色</font></p><p><font face="Comic Sans MS">⑤ 使用分布式的终止算法检查剩余的工作，发现标记阶段完成后进入标记终止阶段</font></p></div></div></div></foreignObject><text x="285" y="52" fill="#000000" font-family="Helvetica" font-size="12px">标记阶段① 将状态切换至 _GCmark，开启写屏障，用户程序协助（Mutator Assiste）并将根对象入队...</text></switch></g><path d="M 760 240 Q 760 240 823.63 240" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 828.88 240 L 821.88 243.5 L 823.63 240 L 821.88 236.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 570 175 L 570 175.03 L 580 175.35 L 590 175.73 L 600 175.68 L 610 174.42 L 620 174.74 L 630 174.4 L 640 175.61 L 650 174.92 L 660 174.73 L 670 174.69 L 680 175.69 L 690 174.46 L 700 175.73 L 710 175.61 L 720 174.48 L 730 175.57 L 740 174.91 L 750 174.86 L 760 175 L 760.74 175 L 760.28 185 L 759.54 195 L 760.01 205 L 759.92 215 L 760.05 225 L 760.5 235 L 759.53 245 L 760.37 255 L 759.41 265 L 759.87 275 L 760.08 285 L 759.32 295 L 760 305 L 760 305.58 L 750 304.61 L 740 305.2 L 730 305.3 L 720 305.74 L 710 304.46 L 700 305.65 L 690 305.12 L 680 305.59 L 670 304.63 L 660 305.35 L 650 305.39 L 640 304.53 L 630 305.32 L 620 304.83 L 610 305.44 L 600 305.66 L 590 304.92 L 580 305.47 L 570 305 L 569.54 305 L 569.91 295 L 569.26 285 L 569.9 275 L 570.07 265 L 569.4 255 L 570.75 245 L 570.29 235 L 569.36 225 L 569.51 215 L 569.67 205 L 570.63 195 L 569.91 185 L 570 175 L 570 175 Z Z" fill="#eeeeee" stroke="#36393d" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 182px; height: 1px; padding-top: 165px; margin-left: 575px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 140px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1><font face="Comic Sans MS">标记终止阶段</font></h1><p><font face="Comic Sans MS">① <b><font color="#cc0000">暂停程序</font></b>。将状态切换至 <b><font color="#006633">_GCmarktermination</font></b> 并关闭辅助标记的用户程序</font></p><p><font face="Comic Sans MS">② 清理处理器上的线程缓存</font></p></div></div></div></foreignObject><text x="575" y="177" fill="#000000" font-family="Helvetica" font-size="12px">标记终止阶段① 暂停程序。将状态切换至 _GCmarktermination 并关闭辅助标记的用户程序...</text></switch></g><path d="M 830 135 L 830 135.21 L 840 135.67 L 850 135.28 L 860 134.54 L 870 135.36 L 880 134.37 L 890 135.53 L 900 135.57 L 910 135.41 L 920 135.44 L 930 134.92 L 940 135.08 L 950 134.84 L 960 135.63 L 970 134.33 L 980 134.26 L 990 135.28 L 1000 134.86 L 1010 134.55 L 1020 135 L 1020.19 135 L 1020.14 145 L 1019.41 155 L 1019.95 165 L 1020.35 175 L 1020.47 185 L 1020.4 195 L 1019.89 205 L 1020.6 215 L 1020.4 225 L 1019.29 235 L 1019.42 245 L 1019.89 255 L 1020.13 265 L 1020.42 275 L 1020.4 285 L 1019.59 295 L 1019.52 305 L 1019.75 315 L 1020.56 325 L 1019.83 335 L 1020 345 L 1020 345.12 L 1010 345.35 L 1000 345.29 L 990 345.27 L 980 344.62 L 970 345.41 L 960 345.61 L 950 344.26 L 940 344.52 L 930 344.59 L 920 344.3 L 910 344.92 L 900 344.64 L 890 344.63 L 880 344.77 L 870 344.61 L 860 345.7 L 850 344.63 L 840 345.15 L 830 345 L 829.96 345 L 830.41 335 L 830.43 325 L 830.44 315 L 829.36 305 L 830.16 295 L 830.67 285 L 829.54 275 L 830.29 265 L 830.19 255 L 829.48 245 L 829.74 235 L 829.64 225 L 830.51 215 L 829.84 205 L 830.22 195 L 829.85 185 L 830.37 175 L 830.63 165 L 830.26 155 L 829.77 145 L 830 135 L 830 135 Z Z" fill="#f0a30a" stroke="#bd7000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 182px; height: 1px; padding-top: 125px; margin-left: 835px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 220px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1><font face="Comic Sans MS">清理阶段</font></h1><p><font face="Comic Sans MS">① 将状态切换至 <b><font color="#006633">_GCoff</font></b>，开始清理阶段。初始化清理状态并关闭写屏障</font></p><p><font face="Comic Sans MS">② 恢复用户程序，所有新创建的对象会标记成白色</font></p><p><font face="Comic Sans MS">③ 后台并发清理所有的内存管理单元，当 Goroutine 申请新的内存管理单元时会触发清理</font></p></div></div></div></foreignObject><text x="835" y="137" fill="#ffffff" font-family="Helvetica" font-size="12px">清理阶段① 将状态切换至 _GCoff，开始清理阶段。初始化清理状态并关闭写屏障...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>