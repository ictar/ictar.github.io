<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="824px" height="481px" viewBox="-0.5 -0.5 824 481" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 453 170 L 453 170.07 L 463 170.7 L 473 169.35 L 483 170.44 L 493 169.5 L 503 169.27 L 513 169.66 L 523 170.19 L 533 169.3 L 543 170.54 L 553 169.74 L 563 170.66 L 573 170.26 L 583 169.68 L 593 170.17 L 603 169.57 L 613 169.65 L 623 169.67 L 633 170.31 L 643 170.68 L 653 170.1 L 663 169.88 L 673 169.61 L 683 170.14 L 693 170.57 L 703 170.52 L 713 170.56 L 723 170.67 L 733 169.72 L 743 169.9 L 753 170.27 L 763 170.31 L 773 170.18 L 783 170.18 L 793 169.25 L 803 170 L 813 170.56 L 823 170 L 823.25 170 L 822.97 180 L 823.63 190 L 823.17 200 L 823.75 210 L 822.59 220 L 822.26 230 L 822.7 240 L 823.17 250 L 822.73 260 L 823.62 270 L 822.52 280 L 822.78 290 L 822.73 300 L 823.5 310 L 823.31 320 L 823 330 L 823 329.71 L 813 329.46 L 803 330.1 L 793 329.87 L 783 330.32 L 773 329.99 L 763 330.26 L 753 330.4 L 743 330.33 L 733 330.74 L 723 330.43 L 713 329.48 L 703 330.62 L 693 330.58 L 683 329.3 L 673 330.47 L 663 329.74 L 653 329.46 L 643 329.66 L 633 329.39 L 623 330.62 L 613 329.33 L 603 330.27 L 593 330.38 L 583 330.41 L 573 330.72 L 563 330.43 L 553 330.71 L 543 329.94 L 533 329.86 L 523 330.62 L 513 330.73 L 503 329.82 L 493 329.67 L 483 329.84 L 473 329.35 L 463 329.68 L 453 330 L 452.59 330 L 453.45 320 L 452.59 310 L 452.99 300 L 453.23 290 L 453.37 280 L 452.36 270 L 452.62 260 L 452.87 250 L 453.06 240 L 453.2 230 L 453 220 L 453.6 210 L 453.55 200 L 452.4 190 L 452.31 180 L 453 170 L 453 170 Z Z" fill="#f8cecc" stroke="#b85450" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 362px; height: 1px; padding-top: 160px; margin-left: 457px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; max-height: 170px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>问题</h1><p>① 热分裂问题（hot split）：当当前 goroutine 的栈几乎充满的时候，任意的函数调用都会触发栈扩容，而函数返回后又会触发栈缩容。那么，如果在一个循环中调用函数，栈的分配和释放就会造成巨大的额外开销</p><p>② 一旦 goroutine 使用的内存越过了分段栈的扩缩容阈值，运行时就会触发栈的扩容和缩容，这会带来额外的工作量</p></div></div></div></foreignObject><text x="638" y="172" fill="#000000" font-family="Comic Sans MS" font-size="12px" text-anchor="middle">问题① 热分裂问题（hot split）：当当前 goroutine 的栈几乎充满的时候，任意的函数调用都会触发栈扩容，而函数返回后又会触发栈缩容。那么，如果在一个循环中调用函数，栈的分配和释放就会造成巨大的额外开销...</text></switch></g><rect x="40" y="110" width="370" height="180" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 362px; height: 1px; padding-top: 100px; margin-left: 44px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; max-height: 190px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>特点</h1><p>Go 1.3 之前的实现，是一种不连续但是可以持续增长的栈。</p><p>① 初始：一块固定大小的内存空间</p><p>② 扩容：当需要更多栈空间的时候，会分配一个新的段，和上一个栈双向链接。这样，当前 goroutine 的多个栈空间会以链表的形式串联起来。运行时通过指针找到连续的栈片段</p><p>③ 缩容：一旦 goroutine 申请的栈空间使用完毕，运行时就会释放</p></div></div></div></foreignObject><text x="225" y="112" fill="#000000" font-family="Comic Sans MS" font-size="12px" text-anchor="middle">特点Go 1.3 之前的实现，是一种不连续但是可以持续增长的栈。...</text></switch></g><path d="M 450 50 L 450 49.47 L 460 50.73 L 470 50.2 L 480 49.73 L 490 50.65 L 500 49.28 L 510 49.43 L 520 49.69 L 530 49.71 L 540 49.91 L 550 50.7 L 560 49.31 L 570 50.13 L 580 49.9 L 590 50.09 L 600 50.38 L 610 50.65 L 620 50.52 L 630 50.26 L 640 49.9 L 650 49.54 L 660 50.63 L 670 50.67 L 680 50.63 L 690 50.21 L 700 50.1 L 710 49.73 L 720 50.32 L 730 50.44 L 740 49.52 L 750 50.2 L 760 49.51 L 770 50.42 L 780 50.13 L 790 50.21 L 800 50.13 L 810 50.72 L 820 50 L 820.18 50 L 820.02 60 L 820.36 70 L 819.46 80 L 819.58 90 L 820.71 100 L 819.96 110 L 819.53 120 L 819.26 130 L 820.41 140 L 819.89 150 L 820 160 L 820 159.46 L 810 159.4 L 800 160.63 L 790 160.41 L 780 159.92 L 770 159.31 L 760 160.03 L 750 160.5 L 740 159.46 L 730 160.7 L 720 159.67 L 710 159.42 L 700 159.31 L 690 160.73 L 680 160.44 L 670 160.34 L 660 159.65 L 650 159.79 L 640 159.71 L 630 159.52 L 620 160.63 L 610 160.23 L 600 160.06 L 590 160.12 L 580 160.36 L 570 160.7 L 560 159.55 L 550 160.05 L 540 160.04 L 530 160.32 L 520 160.69 L 510 160.34 L 500 160.13 L 490 160.33 L 480 160.72 L 470 159.64 L 460 160.16 L 450 160 L 450.51 160 L 450.03 150 L 449.87 140 L 450.56 130 L 450.38 120 L 450.52 110 L 449.58 100 L 449.97 90 L 449.83 80 L 450.48 70 L 449.31 60 L 450 50 L 450 50 Z Z" fill="#d5e8d4" stroke="#82b366" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 362px; height: 1px; padding-top: 40px; margin-left: 454px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; max-height: 120px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>优点</h1><p>① 在增加新分段时无需对原有分段中的数据进行拷贝，使得 goroutine 的使用代价非常低廉</p><p>② 栈按需增长，按需收缩。</p></div></div></div></foreignObject><text x="635" y="52" fill="#000000" font-family="Comic Sans MS" font-size="12px" text-anchor="middle">优点① 在增加新分段时无需对原有分段中的数据进行拷贝，使得 goroutine 的使用代价非常低廉...</text></switch></g><path d="M 185 440 Q 185 440 258.63 440" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 263.88 440 L 256.88 443.5 L 258.63 440 L 256.88 436.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="85" y="400" width="100" height="80" fill="#1ba1e2" stroke="#006eaf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 440px; margin-left: 86px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">segment</div></div></div></foreignObject><text x="135" y="444" fill="#ffffff" font-family="Comic Sans MS" font-size="12px" text-anchor="middle">segment</text></switch></g><path d="M 365 440 Q 365 440 438.63 440" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 443.88 440 L 436.88 443.5 L 438.63 440 L 436.88 436.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 265 420 Q 265 420 191.37 420" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 186.12 420 L 193.12 416.5 L 191.37 420 L 193.12 423.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="265" y="400" width="100" height="80" fill="#1ba1e2" stroke="#006eaf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 440px; margin-left: 266px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">segment</div></div></div></foreignObject><text x="315" y="444" fill="#ffffff" font-family="Comic Sans MS" font-size="12px" text-anchor="middle">segment</text></switch></g><path d="M 445 420 Q 445 420 371.37 420" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 366.12 420 L 373.12 416.5 L 371.37 420 L 373.12 423.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="445" y="400" width="100" height="80" fill="#1ba1e2" stroke="#006eaf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 440px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">segment</div></div></div></foreignObject><text x="495" y="444" fill="#ffffff" font-family="Comic Sans MS" font-size="12px" text-anchor="middle">segment</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>