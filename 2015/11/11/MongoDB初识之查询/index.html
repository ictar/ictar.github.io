<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">
  <meta name="msapplication-config" content="/images/browserconfig.xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ictar.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="其实就是《MongoDB权威指南》的一些零散笔记。本篇涉及MongoDB的查询操作，包括索引、聚合等">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB初识之查询">
<meta property="og:url" content="http://ictar.github.io/2015/11/11/MongoDB%E5%88%9D%E8%AF%86%E4%B9%8B%E6%9F%A5%E8%AF%A2/index.html">
<meta property="og:site_name" content="∞">
<meta property="og:description" content="其实就是《MongoDB权威指南》的一些零散笔记。本篇涉及MongoDB的查询操作，包括索引、聚合等">
<meta property="og:locale">
<meta property="article:published_time" content="2015-11-11T08:07:43.000Z">
<meta property="article:modified_time" content="2020-12-25T08:20:40.969Z">
<meta property="article:author" content="Ele">
<meta property="article:tag" content="MongoDB">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://ictar.github.io/2015/11/11/MongoDB%E5%88%9D%E8%AF%86%E4%B9%8B%E6%9F%A5%E8%AF%A2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>MongoDB初识之查询 | ∞</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="∞" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">∞</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">好好学习，天天向上</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://ictar.github.io/2015/11/11/MongoDB%E5%88%9D%E8%AF%86%E4%B9%8B%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ele">
      <meta itemprop="description" content="Share life, share idea, share code.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="∞">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MongoDB初识之查询
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-11-11 16:07:43" itemprop="dateCreated datePublished" datetime="2015-11-11T16:07:43+08:00">2015-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-25 16:20:40" itemprop="dateModified" datetime="2020-12-25T16:20:40+08:00">2020-12-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DB/" itemprop="url" rel="index"><span itemprop="name">DB</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2015/11/11/MongoDB%E5%88%9D%E8%AF%86%E4%B9%8B%E6%9F%A5%E8%AF%A2/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/11/MongoDB初识之查询/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">其实就是《MongoDB权威指南》的一些零散笔记。本篇涉及MongoDB的查询操作，包括索引、聚合等</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="查询">查询</h1>
<h2 id="find">find</h2>
<p>使用find进行查询，返回一个集合中文档的子集，子集合的范围从0个文档到整个集合。 <code>find ( query , fields , limit , skip, batchSize, options )</code> * query：查询器文档，决定了要返回哪些文档，这个参数说明了要执行的查询细节 1. 默认为{}，表示匹配集合的全部内容。例如：<code>&gt; db.c.find()</code> 2. 支持多个键/值对的方式将多个查询条件组合在一起。例如：<code>&gt; db.users.find(&#123;"username":"joe","age":27&#125;)</code> * fields：指定返回的键 1. 使用此参数的好处：节省传输的数据量，节省客户端解码文档的时间和内存消耗 2. 使用举例：<code>&gt; db.users.find(&#123;&#125;,&#123;"username":1,"emails":1&#125;)</code> 3. 注意，"_id"这个键总是被返回，即便是没有指定也一样 4. 也可以用来剔除查询结果中的某个键/值对。例如：<code>&gt; db.users.find(&#123;&#125;,&#123;"emails":0&#125;)</code> * limit * skip * batchSize * options</p>
<h2 id="查询条件">查询条件</h2>
<h3 id="比较查询">比较查询</h3>
<p>四种比较操作符："<span class="math inline">\(lt&quot;(&lt;), &quot;\)</span>lte"(&lt;=), "<span class="math inline">\(gt&quot;(&gt;), &quot;\)</span>gte"(&gt;=) <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询在18~30岁（含）的用户</span></span><br><span class="line">&gt; db.users.<span class="builtin-name">find</span>(&#123;<span class="string">&quot;age&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gte</span>&quot;</span>:18,<span class="string">&quot;<span class="variable">$lte</span>&quot;</span>:30&#125;&#125;)</span><br></pre></td></tr></table></figure> 条件操作符："<span class="math inline">\(ne&quot;(&lt;&gt;，用于所有类型的数据) <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询所有名字不为joe的用户</span></span><br><span class="line">&gt; db.users.<span class="builtin-name">find</span>(&#123;<span class="string">&quot;username&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$ne</span>&quot;</span>:<span class="string">&quot;joe&quot;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure> ### OR查询 两种方式 * &quot;\)</span>in"用来查询一个键的多个值 * "$or"用来完成多个键值的任意给定值 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在raffle中查找ticket_no在[725,542,390]中的文档</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;<span class="variable">$in</span>&quot;</span>还可以指定不同类型的条件和值</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.raffle.find(&#123;<span class="string">&quot;ticket_no&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$in</span>&quot;</span>:[725,542,390]&#125;&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;<span class="variable">$nin</span>&quot;</span>将返回与数组中所有条件都不匹配的文档</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面这个语句就是查找ticket_no不在[725,542,390]中的文档</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.raffle.find(&#123;<span class="string">&quot;ticket_no&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$nin</span>&quot;</span>:[725,542,390]&#125;&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;<span class="variable">$or</span>&quot;</span>接受一个包含所有可能条件的数组作为参数</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.raffle.find(&#123;<span class="string">&quot;<span class="variable">$or</span>&quot;</span>:[&#123;<span class="string">&quot;ticket_no&quot;</span>:725&#125;,&#123;<span class="string">&quot;winner&quot;</span>:<span class="literal">true</span>&#125;]&#125;)</span></span><br></pre></td></tr></table></figure> 注意：对于OR类型的查询，第一个条件尽可能匹配更多的文档，这样才最为有效</p>
<h3 id="not-not元条件句可以用在任何其他条件之上与正则表达式联合使用可以用来查找那些与特定模式不符的文档"><span class="math inline">\(not &quot;\)</span>not"：元条件句，可以用在任何其他条件之上。与正则表达式联合使用，可以用来查找那些与特定模式不符的文档。</h3>
<h3 id="条件句-v.s-修改器">条件句 V.S 修改器</h3>
<ol type="1">
<li>条件句是内层文档的键，修改器则是外层文档的键</li>
<li>可以对一个键应用多个条件，但是不能对一个键应用多个更新修改器</li>
</ol>
<h2 id="特定于类型的查询">特定于类型的查询</h2>
<h3 id="null">null</h3>
<ol type="1">
<li>null可以匹配自身</li>
<li>还可以匹配不存在。也就是说，这种匹配会返回缺少这个键的所有文档 <figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 下面这个语句会返回name值为null的文档</span></span><br><span class="line"><span class="meta"># 还会返回没有键值name的所有文档</span></span><br><span class="line">&gt; db.users.find(&#123;<span class="string">&quot;name&quot;</span>:<span class="literal">null</span>&#125;)</span><br></pre></td></tr></table></figure></li>
<li>若只想匹配键值为null的文档，既要检查该键的值是否为null，还要通过"$exists"条件判定键值已存在 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.c.<span class="builtin-name">find</span>(&#123;<span class="string">&quot;z&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$in</span>&quot;</span>:[<span class="literal">null</span>],<span class="string">&quot;<span class="variable">$exists</span>&quot;</span>:true&#125;&#125;)</span><br></pre></td></tr></table></figure> ### 正则表达式 MongoDB使用Perl兼容的正则表达式（PCRE）库来匹配正则表达式。 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 忽略大小写：查找所有名为Joe或者joe的用户</span></span><br><span class="line">&gt; db.users.find(&#123;<span class="string">&quot;username&quot;</span><span class="symbol">:/joe/i</span>&#125;)</span><br><span class="line"><span class="comment"># 匹配各种大小写组合形式的joe</span></span><br><span class="line">&gt; db.users.find(&#123;<span class="string">&quot;username&quot;</span><span class="symbol">:/joe?/i</span>&#125;)</span><br><span class="line"><span class="comment"># 还可以匹配自身</span></span><br><span class="line">&gt; db.foo.insert(&#123;<span class="string">&quot;bar&quot;</span><span class="symbol">:/baz/</span>&#125;)</span><br><span class="line">&gt; db.foo.find(&#123;<span class="string">&quot;bar&quot;</span><span class="symbol">:/baz/</span>&#125;)</span><br></pre></td></tr></table></figure> ### 查询数组</li>
</ol>
<ul>
<li>$all：匹配一组元素，元素的顺序无关紧要 <figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.food.insert(&#123;<span class="string">&quot;_id&quot;</span>:<span class="number">1</span>,<span class="string">&quot;fruit&quot;</span>:[<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;kumquat&quot;</span>,<span class="string">&quot;orange&quot;</span>]&#125;)</span><br><span class="line">&gt; db.food.insert(&#123;<span class="string">&quot;_id&quot;</span>:<span class="number">2</span>,<span class="string">&quot;fruit&quot;</span>:[<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;kumquat&quot;</span>,<span class="string">&quot;orange&quot;</span>]&#125;)</span><br><span class="line">&gt; db.food.insert(&#123;<span class="string">&quot;_id&quot;</span>:<span class="number">3</span>,<span class="string">&quot;fruit&quot;</span>:[<span class="string">&quot;cherry&quot;</span>,<span class="string">&quot;banana&quot;</span>,<span class="string">&quot;apple&quot;</span>]&#125;)</span><br><span class="line"># 查找既有<span class="string">&quot;apple&quot;</span>又有<span class="string">&quot;banana&quot;</span>的文档</span><br><span class="line">&gt; db.food.find(&#123;<span class="string">&quot;fruit&quot;</span>:&#123;$all:[<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;banana&quot;</span>]&#125;&#125;)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="number">1</span>, <span class="string">&quot;fruit&quot;</span> : [ <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;peach&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="number">3</span>, <span class="string">&quot;fruit&quot;</span> : [ <span class="string">&quot;cherry&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span> ] &#125;</span><br></pre></td></tr></table></figure></li>
<li><span class="math inline">\(size：查询指定长度的数组 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.food.<span class="builtin-name">find</span>(&#123;<span class="string">&quot;fruit&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$size</span>&quot;</span>:3&#125;&#125;)</span><br></pre></td></tr></table></figure> 注意：&quot;\)</span>size"不能与其他查询子句组合，但是这种查询可以通过在文档中添加一个"size"键的方式来实现。</li>
<li><span class="math inline">\(slice：返回数组的一个子集合 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 返回前10条评论。如果要返回后10条，使用-10即可</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.blog.posts.findOne(&#123;&#125;,&#123;<span class="string">&quot;comments&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:10&#125;&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$slice</span>接受偏移值和要返回的元素数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面这个语句返回第24~33个元素</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.blog.posts.findOne(&#123;&#125;,&#123;<span class="string">&quot;comments&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:[23,10]&#125;&#125;)</span></span><br></pre></td></tr></table></figure> 注意：如无特别声明，使用\)</span>slice会返回文档中所有键。</li>
</ul>
<h3 id="查询内嵌文档">查询内嵌文档</h3>
<p>两种方式： * 查询整个文档：与普通查询完全相同。要注意，这种查询与顺序是相关的。 * 只针对其键/值对进行查询 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.people.find(&#123;&quot;name.first&quot;:&quot;joe&quot;,&quot;name.last&quot;:&quot;Schemoe&quot;&#125;)</span><br></pre></td></tr></table></figure> 说明：点表示法是查询文档区别于其他文档的主要特点，查询文档时使用表示“深入内嵌文档内部”。因此，也要求待插入的文档不能包含“.”</p>
<h2 id="where查询-使用where子句可以执行任意javascript作为查询的一部分"><span class="math inline">\(where查询 使用&quot;\)</span>where"子句，可以执行任意JavaScript作为查询的一部分</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.insert(&#123;&quot;apple&quot;:1,&quot;banana&quot;:6,&quot;peach&quot;:3&#125;)</span><br><span class="line">&gt; db.foo.insert(&#123;&quot;apple&quot;:8,&quot;spinach&quot;:4,&quot;watermelon&quot;:4&#125;)</span><br><span class="line"># 比较文档中两个键的值是否相等</span><br><span class="line"># 若函数返回true，文档就作为结果的一部分被返回；若为false，则不然</span><br><span class="line">&gt; db.foo.find(&#123;&quot;$where&quot;:function () &#123;</span><br><span class="line">... for (var current in this) &#123;</span><br><span class="line">...     for (var other in this) &#123;</span><br><span class="line">...         if (current !&#x3D; other &amp;&amp; this[current] &#x3D;&#x3D; this[other]) &#123;</span><br><span class="line">...             return true;</span><br><span class="line">...         &#125;</span><br><span class="line">...     &#125;</span><br><span class="line">... &#125;</span><br><span class="line">... return false;</span><br><span class="line">... &#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>注意：如非必要，一定要避免使用"<span class="math inline">\(where&quot;查询。因为它们在速度上比常规查询慢得多（每个文档都要从BSON转换成JavaScript对象，然后通过\)</span>where表达式运行。而且还不能用索引）</p>
<h2 id="游标">游标</h2>
<p>数据库使用游标返回find的执行结果 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 使用cursor变量保存结果</span><br><span class="line">&gt; var cursor &#x3D; db.c.find()</span><br><span class="line"># 使用游标的next方法来迭代结果，hasNext方法检查是否有后续结果存在</span><br><span class="line">&gt; while (cursor.hasNext()) &#123;</span><br><span class="line">... obj &#x3D; cursor.next()</span><br><span class="line">... &#x2F;&#x2F; do stuff</span><br><span class="line">... &#125;</span><br><span class="line"># 游标类实现了迭代器接口，可以在foreach循环中使用</span><br><span class="line">&gt; cursor.forEach(function(x) &#123;</span><br><span class="line">... print (x);</span><br><span class="line">... &#125;);</span><br></pre></td></tr></table></figure> ### limit, skip和sort 最常用的查询选项是限制返回结果的数量(limit)，忽略一定数量的结果(skip)并排序(sort)。所有这些选项一定要在查询被派发到服务器之前添加。 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制结果数量，limit指定上限</span></span><br><span class="line">&gt; db.c.<span class="builtin-name">find</span>().limit(3)</span><br><span class="line"><span class="comment"># 略过前n个匹配的文档，返回如下的文档。若匹配的文档少于n个，则不会返回任何文档</span></span><br><span class="line">&gt; db.c.<span class="builtin-name">find</span>().skip(3)</span><br><span class="line"><span class="comment"># sort用一个对象作为参数：一组键/值对。</span></span><br><span class="line"><span class="comment"># 键对应文档的键名，值代表排序的方向(1：升序；-1：降序)。</span></span><br><span class="line"><span class="comment"># 若指定了多个键，则按照多个键的顺序逐个排序</span></span><br><span class="line">&gt; db.c.<span class="builtin-name">find</span>().sort(&#123;x:1,age:-1&#125;)</span><br><span class="line"><span class="comment"># 可以组合来用。例如：分页</span></span><br><span class="line">&gt; db.stock.<span class="builtin-name">find</span>(&#123;<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;mp3&quot;</span>&#125;).limit(50).skip(50).sort(&#123;<span class="string">&quot;price&quot;</span>:-1&#125;)</span><br></pre></td></tr></table></figure> 对于混合类型的键排序顺序是预先定义好的。从小到大，顺序如下： 1. 最小值 2. null 3. 数字（整型、长整型、双精度） 4. 字符串 5. 对象/文档 6. 数组 7. 二进制数据 8. 对象ID 9. 布尔型 10. 日期型 11. 时间戳 12. 正则表达式 13. 最大值</p>
<h3 id="避免使用skip略过大量结果">避免使用skip略过大量结果</h3>
<p>当skip的数量非常多的时候，会变得很慢，所以要尽量避免 * 不用skip对结果分页：一般来讲，可以找到一种方法实现不用skip的分页。 * 随机选取文档：可以在插入文档时给每个文档都添加一个额外的随机键以避免skip</p>
<h3 id="高级查询选项">高级查询选项</h3>
<p>两种查询： 1. 普通查询：<code>&gt; var cursor = db.foo.find(&#123;"foo":"bar"&#125;)</code> 2. 包装查询：<code>&gt; var cursor = db.foo.find(&#123;"foo":"bar"&#125;).sort(&#123;"x":1&#125;)</code>。这种查询实际上会被转化为<code>db.foo.find(&#123;"$query":&#123;"foo":"bar"&#125;, "$orderby": &#123;"x":1&#125;&#125;)</code> 下面是一些有用选项： * $maxscan：integer 指定查询最多扫描的文档数量 * $min：document 查询的开始条件 * $max：document 查询的结束条件 * $hint：document 指定服务器使用哪个索引进行查询 * $explain：boolean 获取查询执行的细节（用到的索引、结果数量、耗时等），而并非真正执行查询 * $snapshot：boolean 确保查询的结果是在查询执行的一致快照</p>
<h3 id="获取一致结果">获取一致结果</h3>
<p>当查找修改后存回去时，可能会出现由于文档体积增加而预留空间不足造成的移动。通常会将其挪至集合的末尾处。这样的情况下，游标有可能会返回那些已经被挪动的文档。 解决方法是对查询进行<strong>快照</strong>，也就是使用"$snapshot"选项。这个时候，查询是针对不变的集合视图运行的。</p>
<h2 id="在服务端的游标">在服务端的游标</h2>
<p>游标在服务端会消耗内存和其他资源：当游标遍历尽了结果以后或者客户端发来消息要求终止，数据库才会释放这些资源 导致游标终止（随后被清理）的一些情况： 1. 游标完成匹配结果的迭代时会清理自身； 2. 当游标在客户端已经不在作用域内了，驱动会向服务器发送专门的消息让其销毁游标； 3. 只要10分钟不使用游标，数据库游标就会自动销毁。</p>
<h1 id="索引">索引</h1>
<p>索引是用来加速查询的。 当查询中仅使用一个键时，可以对该键建立索引，以提高查询速度。 <figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># ensureIndex方法：创建索引</span></span><br><span class="line">&gt; db.users.ensureIndex(&#123;<span class="string">&quot;username&quot;</span>:<span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta"># 一组值为1（升序）或-1（降序）的键，表示索引创建的方向。</span></span><br><span class="line"><span class="meta"># 若索引只有一个键，则方向无关紧要</span></span><br><span class="line">&gt; db.posts.ensureIndex(&#123;<span class="string">&quot;date&quot;</span>:<span class="number">1</span>, <span class="string">&quot;username&quot;</span>:<span class="number">-1</span>&#125;)</span><br></pre></td></tr></table></figure> MongoDB的查询优化器会重排查询项的顺序，以便利用索引。 创建索引的缺点是每次插入、更新和删除时都会产生额外的开销（数据库不但需要执行这些操作，还要讲这些数据在集合的索引中标记）。</p>
<ul>
<li>使用索引前三问
<ol type="1">
<li>会做什么样的查询？其中哪些键需要索引？</li>
<li>每个键的索引方向是怎样的？</li>
<li>如何应对扩展？有没有种不同键的排列可以使常用数据更多地保留在内存中？</li>
</ol></li>
<li>为内嵌文档的键建立索引和为普通的键创建索引没有什么区别。而对内嵌文档的键索引与普通键索引并无差异，二者可以联合组成复合索引。</li>
<li>由于做无索引排序时有内存限制的，因此，可以按照排序来索引以便让MongoDB按照顺序提取数据。</li>
<li>索引名字
<ol type="1">
<li>每个索引都有一个字符串类型的名字，来唯一标识索引</li>
<li>默认情况下，索引名类似<code>keyname1_dir1_keyname2_dir2_..._keynameN_dirN</code>，其中keynameX代表索引的键，dirX代表索引的方向(-1/1)</li>
<li>可以自定义索引名字，例如：<code>&gt; db.foo.ensureIndex(&#123;"a":1,"b":-1&#125;, &#123;"name":"alphabet"&#125;)</code></li>
</ol></li>
</ul>
<h2 id="唯一索引">唯一索引</h2>
<p>唯一索引可以确保集合的每一个文档的指定键都有唯一值 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建唯一索引：&#123;<span class="string">&quot;unique&quot;</span>:<span class="literal">true</span>&#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.users.ensureIndex(&#123;<span class="string">&quot;username&quot;</span>:1&#125;,&#123;<span class="string">&quot;unique&quot;</span>:<span class="literal">true</span>&#125;)</span></span><br></pre></td></tr></table></figure> * 记住，默认情况下，insert不检查文档是否插入过了。因此，可以使用安全插入。 * 对"_id"的索引是在创建普通集合时一通创建的。这个索引和普通唯一索引只有一点不同，就是不能删除。 * 插入时，若无对应键，索引会将其作为null存储。所以，如果对某个键建立了唯一索引，但插入了多个缺少该索引键的文档，则由于文档包含null值而导致插入失败。 * 当为已有集合创建索引时，若有些值已经重复了，则会创建索引失败。此时，可以使用<code>dropDups</code>选项保留发现的第一个文档，删除接下来的有重复值的文档。例如：<code>&gt; db.users.ensureIndex(&#123;"username":1&#125;,&#123;"unique":true, "dropDups:true"&#125;)</code> * 创建复合唯一索引时，单个键的值可以相同，只要所有键的值组合起来不同即可。</p>
<h2 id="explain和hint">explain和hint</h2>
<ul>
<li>explain：获得查询方面的信息。 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># explain会返回一个文档</span></span><br><span class="line"><span class="comment"># 文档中包含了查询使用的索引情况（若有），耗时及扫描文档数的统计信息。</span></span><br><span class="line">&gt; db.users.<span class="builtin-name">find</span>(&#123;<span class="string">&quot;age&quot;</span>:18&#125;).sort(&#123;<span class="string">&quot;username&quot;</span>:1&#125;).explain()</span><br></pre></td></tr></table></figure></li>
<li>hint：当发现MongoDB用了非预期的索引，可以用hint强制使用某个索引 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.c.find(&#123;&quot;age&quot;:14, &quot;username&quot;:&#x2F;.*&#x2F;&#125;).hint(&#123;&quot;username&quot;:1,&quot;age&quot;:1&#125;）</span><br></pre></td></tr></table></figure> ## 索引管理 索引的元信息存储在每个数据库的<code>system.indexes</code>集合中。这个是个保留集合，不能对其插入或删除文档。操作只能通过<code>ensureIndex</code>或者<code>dropIndexes</code>进行。 <code>system.namespaces</code>集合含有索引的名字。里面包含了两种信息，集合本身和对应集合包含的索引。 注意：集合名和索引名加起来不能超过127字节。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 使用background选项让建立索引操作在后台完成，同时不阻塞正常请求</span><br><span class="line">&gt; db.users.ensureIndex(&#123;&quot;username&quot;:1&#125;,&#123;&quot;background&quot;:true&#125;)</span><br></pre></td></tr></table></figure> 为已有文档创建索引比先创建索引再插入所有文档要快一点。 <figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># dropIndexes：删除索引</span></span><br><span class="line"><span class="meta"># 通常，要查一下system.indexes集合来找出索引名</span></span><br><span class="line">&gt; db.runCommand(&#123;<span class="string">&quot;dropIndexes&quot;</span>:<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;alphabet&quot;</span>&#125;)</span><br><span class="line"><span class="meta"># 删除所有索引</span></span><br><span class="line">&gt; db.runCommand(&#123;<span class="string">&quot;dropIndexes&quot;</span>:<span class="string">&quot;users&quot;</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;*&quot;</span>&#125;)</span><br><span class="line"><span class="meta"># 这里注意，删除集合也会删除索引。</span></span><br></pre></td></tr></table></figure> ## 地理空间索引 地理空间索引：MongoDB为坐标平面查询提供的专门的索引 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 参数<span class="string">&quot;2d&quot;</span>：创建地理空间索引</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;gps&quot;</span>键的值必须是某种形式的一对值：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个包含两个元素的数组或是包含两个键的内嵌文档</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.map.ensureIndex(&#123;<span class="string">&quot;gps&quot;</span>:<span class="string">&quot;2d&quot;</span>&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认情况下，地理空间索引假设值的范围是-180~180</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以通过ensureIndex选项来指定最大最小值</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.star.trek.ensureIndex(&#123;<span class="string">&quot;light-years&quot;</span>:<span class="string">&quot;2d&quot;</span>&#125;,&#123;<span class="string">&quot;min&quot;</span>:-1000,<span class="string">&quot;max&quot;</span>:1000&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询方法一：使用find命令+<span class="string">&quot;<span class="variable">$near</span>&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 按照离点(40,-73)由近到远的方式将map集合的所有文档都返回</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.map.find(&#123;<span class="string">&quot;gps&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$near</span>&quot;</span>:[40,-73]&#125;&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询方法二：使用geoNear命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> geoNear还会返回每个文档到查询点的距离。</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.runCommand(&#123;geoNear:<span class="string">&quot;map&quot;</span>,near:[40,-73]&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建复合地理空间索引</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.map.ensureIndex(&#123;<span class="string">&quot;location&quot;</span>:<span class="string">&quot;2d&quot;</span>,<span class="string">&quot;desc&quot;</span>1&#125;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.map.find(&#123;<span class="string">&quot;location&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$near</span>&quot;</span>:[-70,30]&#125;,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;coffeeshop&quot;</span>&#125;)</span></span><br></pre></td></tr></table></figure> # 聚合 ## count：返回集合中文档的数量 <figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 没有传参时，返回总文档数</span></span><br><span class="line">&gt; db.foo.count()</span><br><span class="line"><span class="meta"># 可以传递查询，Mongo会计算查询结果的数量</span></span><br><span class="line"><span class="meta"># 注意：增加查询条件会使得count变慢。因为这相当于先查询出来再计数。</span></span><br><span class="line">&gt; db.foo.count(&#123;<span class="string">&quot;x&quot;</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure> ## distinct：找出给定键的所有不同的值 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 使用distinct时必须指定集合和键</span><br><span class="line">&gt; db.runCommand(&#123;&quot;distinct&quot;:&quot;users&quot;, &quot;key&quot;:&quot;age&quot;&#125;)</span><br></pre></td></tr></table></figure> ## group 过程：选定分组所依据的键 -&gt; 将集合依据选定键值的不同分成若干组 —&gt; 聚合每一组内的文档 -&gt; 产生一个结果文档 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.runCommand(&#123;&quot;group&quot;: &#123;</span><br><span class="line">... &quot;ns&quot;:&quot;stocks&quot;, # 指定要进行分组的集合</span><br><span class="line">... &quot;key&quot;:&quot;day&quot;, # 指定文档分组依据的键</span><br><span class="line">... &quot;initial&quot;:&#123;&quot;time&quot;:0&#125;, # 每一组reduce函数调用的初始时间，会作为初始文档传递给后续过程。每一组的所有成员都会使用这个累加器</span><br><span class="line">... &quot;$reduce&quot;:function(doc,prev) &#123; # 每个文档都对应一次这个吊用。系统传递两个参数：当前文档和累加器文档</span><br><span class="line">...     if (doc.time &gt; prev.time) &#123;</span><br><span class="line">...         prev.price &#x3D; doc.price;</span><br><span class="line">...         prev.time &#x3D; doc.time;</span><br><span class="line">...     &#125;</span><br><span class="line">... &#125;&#125;&#125;)</span><br><span class="line"># &quot;finalizer&quot;：完成器，用以精简从数据库传到用户的数据</span><br><span class="line"># &quot;$keyf&quot;：定义分组函数</span><br></pre></td></tr></table></figure> ## MapReduce MapReduce会拆分问题，再将各个部分发送到不同的机器上，让每台机器都完成一部分。当所有机器都完成的时候，再把结果汇集起来形成最终完整的结果。</li>
</ul>
<p>MapReduce的步骤： 1. 映射(map)：将操作映射到集合中的每个文档。 2. 洗牌(shuffle)：按照键分组，并将产生的键值组成列表放到对应的键中 3. 化简(reduce)：把列表中的值化简成一个单值。接着进行洗牌，直到每个键的列表只有一个值为止，这个值就是最后结果。</p>
<p>使用MapReduce的代价，就是速度。</p>
<figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; map = function() <span class="meta">&#123;....&#125;</span> <span class="comment"># 使用emit函数“返回”要处理的值</span></span><br><span class="line">&gt; reduce = function(key, emits) <span class="meta">&#123;....&#125;</span> <span class="comment"># reduce应该能处理emit文档和其他reduce结果的各种组合</span></span><br><span class="line">&gt; mr = db.runCommand(&#123;<span class="string">&quot;mapreduce&quot;</span>:<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;map&quot;</span>:map,<span class="string">&quot;reduce&quot;</span>: reduce&#125;)</span><br><span class="line"><span class="comment"># 对结果集合进行查询</span></span><br><span class="line">&gt; db[mr.<span class="literal">result</span>].find()</span><br></pre></td></tr></table></figure>
<p>MapReduce命令的其他可选的键： * "finalize":函数 将reduce的结果发送给这个键，这是处理过程的最后一步 * "keeptemp":布尔 连接关闭时临时结果集合是否保存 * "output":字符串 结果集合的名字。设定该项隐含keeptemp:true * "query":文档 会在发往map函数前，先用指定条件过滤文档 * "sort":文档 在发往map前先给文档排序 * "limit":整数 发往map函数的文档数量的上限 * "scope":文档 JavaScript代码中要用到的变量 * "verbose":布尔 是否产生更详尽的服务器日志</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>请言小午吃个甜筒~~</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Ele WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Ele Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2015/11/11/MongoDB%E5%88%9D%E8%AF%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9/" rel="prev" title="MongoDB初识之增删改">
      <i class="fa fa-chevron-left"></i> MongoDB初识之增删改
    </a></div>
      <div class="post-nav-item">
    <a href="/2015/11/13/%E4%B8%80%E4%BA%9BSQL%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7/" rel="next" title="一些SQL优化技巧">
      一些SQL优化技巧 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.</span> <span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#find"><span class="nav-number">1.1.</span> <span class="nav-text">find</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="nav-number">1.2.</span> <span class="nav-text">查询条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.1.</span> <span class="nav-text">比较查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#not-not%E5%85%83%E6%9D%A1%E4%BB%B6%E5%8F%A5%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%85%B6%E4%BB%96%E6%9D%A1%E4%BB%B6%E4%B9%8B%E4%B8%8A%E4%B8%8E%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%81%94%E5%90%88%E4%BD%BF%E7%94%A8%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E6%9F%A5%E6%89%BE%E9%82%A3%E4%BA%9B%E4%B8%8E%E7%89%B9%E5%AE%9A%E6%A8%A1%E5%BC%8F%E4%B8%8D%E7%AC%A6%E7%9A%84%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.2.</span> <span class="nav-text">\(not &quot;\)not&quot;：元条件句，可以用在任何其他条件之上。与正则表达式联合使用，可以用来查找那些与特定模式不符的文档。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%8F%A5-v.s-%E4%BF%AE%E6%94%B9%E5%99%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">条件句 V.S 修改器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E5%AE%9A%E4%BA%8E%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.</span> <span class="nav-text">特定于类型的查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.3.1.</span> <span class="nav-text">null</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%86%85%E5%B5%8C%E6%96%87%E6%A1%A3"><span class="nav-number">1.3.2.</span> <span class="nav-text">查询内嵌文档</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#where%E6%9F%A5%E8%AF%A2-%E4%BD%BF%E7%94%A8where%E5%AD%90%E5%8F%A5%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8Fjavascript%E4%BD%9C%E4%B8%BA%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86"><span class="nav-number">1.4.</span> <span class="nav-text">\(where查询 使用&quot;\)where&quot;子句，可以执行任意JavaScript作为查询的一部分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87"><span class="nav-number">1.5.</span> <span class="nav-text">游标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8skip%E7%95%A5%E8%BF%87%E5%A4%A7%E9%87%8F%E7%BB%93%E6%9E%9C"><span class="nav-number">1.5.1.</span> <span class="nav-text">避免使用skip略过大量结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2%E9%80%89%E9%A1%B9"><span class="nav-number">1.5.2.</span> <span class="nav-text">高级查询选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%80%E8%87%B4%E7%BB%93%E6%9E%9C"><span class="nav-number">1.5.3.</span> <span class="nav-text">获取一致结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E6%B8%B8%E6%A0%87"><span class="nav-number">1.6.</span> <span class="nav-text">在服务端的游标</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">2.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="nav-number">2.1.</span> <span class="nav-text">唯一索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#explain%E5%92%8Chint"><span class="nav-number">2.2.</span> <span class="nav-text">explain和hint</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ele</p>
  <div class="site-description" itemprop="description">Share life, share idea, share code.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ictar" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ictar" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ele.qiong@gmail.com" title="E-Mail → mailto:ele.qiong@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5842594146" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5842594146" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ele</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://ictargithub.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://ictar.github.io/2015/11/11/MongoDB%E5%88%9D%E8%AF%86%E4%B9%8B%E6%9F%A5%E8%AF%A2/";
    this.page.identifier = "2015/11/11/MongoDB初识之查询/";
    this.page.title = "MongoDB初识之查询";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://ictargithub.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
